# 获得初始位置

1. 得到重力向下的轴。
2. 得到指向北的轴。
3. 叉乘，得到指向东的轴。
4. 分别进行normalize。

## 滤波器更新

（判断磁力计读数是否有效）

* 无效：

  不用磁力计算

* 有效：

  （判断加速度计读数是否有效）

  * 有效：

    归一化加速度计和磁力计

    补偿磁力计的偏差 compensate magnetic distortion

    计算梯度下降步长（磁力计，加速度计）

    归一化四元数

    补偿陀螺仪drift

    通过陀螺仪计算出delta q

    反馈

  * 无效：

    通过陀螺仪计算出delta q

  加上delta q 乘以delta t

  正则化

## 补偿磁力计偏差



