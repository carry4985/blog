# 看门狗

## 看门狗概念

在由单片机组成的微型计算机系统中，由于单片机的工作常常会受到来自外界电磁场的干扰，造成程序的跑飞，而陷入死循环，程序的正常运行被打断，由单片机控制的系统无法继续工作，会造成整个系统陷入停滞状态，发生不可预料的后果，所以出于对单片机运行状态进行实时监测的考虑，便产生了一种专门用于检测单片机程序运行状态的模块或者芯片，俗称“看门狗(watchdog)”。

## 看门狗解决的问题

在启动正常运行的时候，系统不能复位。

在系统跑飞（程序异常执行）的情况，系统复位，程序重新执行。

内置两个看门狗，独立看门狗(IWDG)和窗口看门狗.独立看门狗用专用的低速时钟(LSI)驱动，需要看门狗作为一个在主程序之外能够完全独立工作，并且对时间精度要求低的场合。

窗口看门狗由从`APB1`时钟分频后得到时钟驱动。通过可配置的时间窗口来检测应用程序非正常的过迟或过早操作。适合那些要求看门狗在精确计时窗口起作用的程序。

## 独立看门狗功能描述

在键值寄存器(IWDG_KR)中写入`0xCCCC`开始启用独立看门狗。此时计数器开始从其复位值0xfff递减，当计数器计数到尾值0x000时会产生一个复位信号(IWDG_RESET).

无论何时，只要在键值寄存器`IWDG_KR`中写入`0xAAAA`(通常说的喂狗)，自动重装载寄存器`IWDG_RLR`的值就会重新加载到计数器，从而避免看门狗复位。

如果程序异常，就无法正常喂狗，从而系统复位。

### 独立看门狗超时时间

`Tout = ((4*2^prer)*rlr)/32`

`prer`预分频系数

频率LSI=32K，一个看门狗时钟周期就是最短超时时间。

最长超时时间

### 独立看门狗操作步骤

1. 初始化看门狗：预分频系数，重装载值。
	`HAL_IWDG_Init();`
	该函数在操作PR盒RLR寄存器之前会取消写保护。
2. 启动看门狗
	`HAL_IWDG_Start();`
3. 喂狗
	`HAL_IWDG_Refresh();`

