# DMA

DMA全称`Direct Memory Access`,即直接存储器访问。

DMA传输将数据从一个地址空间复制到另一个地址空间，当CPU初始化这个传输动作，传输动作本身是由DMA控制器来实现和完成的。

DMA传输方式无需CPU直接控制传输，也没有中断处理方式那样保留现场和恢复现场过程，通过硬件为RAM和IO设备开辟一条直接传输数据的通道，使得CPU的效率大大提高。

作用：为CPU减负。

F7最多有2个DMA控制器，2个DMA控制器共有16个数据流（每个控制器8个）。每个DMA控制器都用于管理一个或多个外设的存储器访问请求。每个数据流总共可以有多达8个通道（或请求），每个通道都有一个仲裁器，用于处理DMA请求间的优先级。

## DMA数据流

8个DMA控制器数据流都能够提供源和目标之间的单向传输链路。

每个数据流配置后都可以执行：

* 常规类型事务: 存储器到外设、外设到存储器或存储器到存储器的传输。
* 双缓冲区类型事务：使用存储器的两个存储器时针的双缓冲区传输（当DMA正在进行自/至缓冲区的读/写操作时，应用程序可以进行至/自其它缓冲区的写/读操作）

要传输的数据量（多达65535）可以编程，并与连接到外设AHB端口的外设（请求DMA传输）的源宽度相关。每个事务完成后，包含要传输的数据项总量的寄存器都会递减。

## DMA 事务

DMA事务由给定数目的数据传输序列组成，要传输的数据项的数目及其宽度（8位、16位或32位）可用软件编程。

每个DMA传输包含三项操作：

* 通过`DMA_SxPAR`或`DMA_SxM0AR`寄存器寻址，从外设数据寄存器或存储单元中加载数据。
* 通过`DMA_SxPAR`或`DMA_SxM0AR`寄存器寻址，将加载的数据存储到外设数据寄存器或存储器单元。
* `DMA_SxNDTR`计数器在数据存储结束后递减，该计数器中包括仍需执行的事务数。

在产生事件后，外设会向DMA控制器发送请求信号。DMA控制器根据通道优先级处理该请求。只要DMA控制器访问外设，DMA控制器就会向外设发送确认信号。外设获得DMA控制器的确认信号后，便会立即释放其请求。一旦外设使请求失效，DMA控制器就会释放确认信号。如果有更多请求，外设可以启动下一个事务。

## 仲裁器

仲裁器为两个AHB主端口（存储器和外设端口）提供基于请求优先级的8个DMA数据流请求管理，并启动外设/存储器访问序列。


